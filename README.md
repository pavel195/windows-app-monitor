# Мониторинг запуска приложений Windows с уведомлениями в Telegram

Проект позволяет отслеживать запуск приложений в Windows и отправлять уведомления в Telegram. Также предоставляет возможность открытия видео с помощью кнопки в Telegram боте.

## Функциональность

- Мониторинг журнала событий Windows для отслеживания запуска приложений
- Отправка уведомлений о запуске приложений в Telegram
- Возможность открытия видео в браузере через кнопку в Telegram боте
- Настройка списка отслеживаемых приложений и пользователей, имеющих доступ к боту

## Требования

- Windows 10/11
- Python 3.6+
- Доступ к журналу событий Windows (требуются права администратора)
- Telegram бот (токен)

## Установка

1. Клонируйте репозиторий или загрузите исходный код:
```
git clone https://github.com/your-username/windows-app-monitor.git
cd windows-app-monitor
```

2. Установите зависимости:
```
pip install -r requirements.txt
```

3. Создайте файл окружения `.env` на основе примера `env.example`:
```
copy env.example .env
```

4. Отредактируйте файл `.env` и укажите токен Telegram бота и другие настройки.

## Настройка Telegram бота

1. Создайте нового бота с помощью [BotFather](https://t.me/botfather) в Telegram
2. Получите токен бота
3. Добавьте полученный токен в файл `.env`: `TELEGRAM_BOT_TOKEN=your_token_here`
4. Для определения вашего Telegram ID воспользуйтесь ботом [userinfobot](https://t.me/userinfobot)
5. Добавьте ваш ID и ID других пользователей в файл `.env` через запятую: `TELEGRAM_ALLOWED_USERS=123456789,987654321`
6. Чтобы отправлять уведомления в определенный чат (группу, канал или пользователю), укажите `TELEGRAM_CHAT_ID` в файле `.env`

## Конфигурация

Настройки приложения можно задать через переменные окружения в файле `.env` или через файл конфигурации `config.yaml`. Приоритет имеют настройки из файла `.env`.

### Переменные окружения

| Переменная | Описание | Пример |
|------------|----------|--------|
| TELEGRAM_BOT_TOKEN | Токен вашего Telegram бота | 1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ |
| TELEGRAM_ALLOWED_USERS | ID пользователей через запятую | 123456789,987654321 |
| TELEGRAM_CHAT_ID | ID чата для отправки уведомлений | -1001234567890 или @channelname |
| EVENT_LOG_NAME | Имя журнала Windows | Application |
| CHECK_INTERVAL | Интервал проверки в секундах | 5 |
| TRACKED_APPS | Приложения для отслеживания через запятую | chrome.exe,firefox.exe |
| VIDEO_URL | URL видео для кнопки в боте | https://www.youtube.com/watch?v=xm3YgoEiEDc |

### Файл config.yaml

Файл `config.yaml` создается автоматически при первом запуске и содержит настройки из переменных окружения. Вы можете вручную изменить этот файл, но настройки из `.env` имеют более высокий приоритет.

Пример файла:
```yaml
telegram:
  bot_token: 1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ
  allowed_users: [123456789, 987654321]
  chat_id: -1001234567890
monitoring:
  log_name: Application
  check_interval: 5
  tracked_apps: [chrome.exe, firefox.exe]
video:
  url: https://www.youtube.com/watch?v=xm3YgoEiEDc&ab_channel=10Hours
```

## Запуск

### Обычный запуск
```
python main.py
```

### Запуск с правами администратора (рекомендуется)
Для корректного доступа к журналу событий Windows рекомендуется запускать приложение с правами администратора:

Просто запустите файл `run_as_admin.bat`

Или вручную запустите командную строку от имени администратора и выполните:
```
python main.py
```

### Запуск в фоновом режиме
Для запуска приложения в фоновом режиме:
```
start.bat
```

## Использование бота

В Telegram боте доступны следующие команды:
- `/start` - Начало работы с ботом
- `/help` - Список доступных команд
- `/video` - Показать кнопку для открытия видео

## Автозапуск при старте Windows

Для настройки автозапуска при старте Windows, создайте ярлык в папке автозагрузки:

1. Нажмите Win+R, введите `shell:startup` и нажмите Enter
2. Создайте ярлык на файл `run_as_admin.bat`
3. Щелкните по ярлыку правой кнопкой мыши и выберите "Свойства"
4. На вкладке "Ярлык" в поле "Запуск" выберите "Свернутое в окно"
5. Нажмите "ОК"

## Устранение неполадок

### Ошибка доступа к журналу событий
- Убедитесь, что программа запущена с правами администратора через `run_as_admin.bat`
- Проверьте, что указанный журнал существует (по умолчанию "Application")
- Проверьте настройки безопасности журнала событий Windows

### Бот не отправляет сообщения
- Проверьте правильность токена бота в файле `.env`
- Проверьте, что указан правильный `TELEGRAM_CHAT_ID` или `TELEGRAM_ALLOWED_USERS` в файле `.env`
- Убедитесь, что бот имеет разрешение отправлять сообщения в указанный чат
- Убедитесь, что вы начали диалог с ботом, отправив команду `/start` 